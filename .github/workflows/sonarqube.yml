name: SonarCloud (bank-api-library)

on:
  pull_request:
    paths:
      - 'bank-api-library/**'
      - 'gradle/**'
  push:
    branches: [ main ]
    paths:
      - 'bank-api-library/**'
      - 'gradle/**'

jobs:
  analyze:
    runs-on: ubuntu-latest
    timeout-minutes: 25
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }
      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'
          cache: gradle
      # Build bytecode only; tests are optional for Sonar (needed only for coverage)
      - name: Build (assemble only)
        run: ./gradlew -p bank-api-library assemble
      - name: Sonar scan (Action)
        uses: SonarSource/sonarqube-scan-action@v6
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        with:
          projectBaseDir: bank-api-library
          # or provide args here if you don't have sonar-project.properties
          # args: >
          #   -Dsonar.projectKey=bank-api-library
          #   -Dsonar.organization=gini
          #   -Dsonar.host.url=https://sonarcloud.io
